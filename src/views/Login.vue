<template>
  <v-layout row class="justify-center" style="background-image: linear-gradient(to right, #6200ea, #e94057, #8a2387)">
      <v-flex xs4 >
        <v-container style="position: relative;" class="text-xs-center">
          <v-card flat>
          <v-img
            src= "https://media1.giphy.com/media/YlmI36YAWe7KScC7hK/giphy.gif"
            class="my-3"
            contain
            height="200"
          ></v-img>
            <v-card-title class="justify-center" primary-title >
              <h4>¿Sómos familia? - Análisis de ADN</h4>
              <h4>Iniciar Sesión</h4>
            </v-card-title>
            <v-form>
            <v-text-field v-model="email" name="Mail" label="Correo electrónico" :rules="[rules.required, rules.email]"></v-text-field>
            <v-text-field v-model="password" name="Password" label="Contraseña" type="password"></v-text-field>
            <!--Boton inicio-->
            <v-card-actions>
              <v-btn primary @click="login()" large block color="#c2a0f2">Iniciar sesión</v-btn>
            </v-card-actions>
            <h4>También puedes iniciar sesión con: </h4>
            <v-card-actions>
              <v-btn primary large block color="#c2a0f2" @click="loginFacebook()">Facebook</v-btn>
            </v-card-actions>
            <h4>¿No tienes una cuenta aún? </h4>
            <a @click="goregistro()" target="_blank">¡Registrate!</a>
            </v-form>
          </v-card>
        </v-container>
      </v-flex>
    </v-layout>
</template>
<script>
import Vue from 'vue';
  export default{
    
    data () {
      return {
        isConnected: false,
        email: this.$store.state.email,
        password: '',
        user: this.$store.state.user,
        rules: {
          required: value => !!value || 'Required.',
          email: value => {
            const pattern = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
            return pattern.test(value) || 'Invalid e-mail.'
          },
        },
      }
    },
     created() {
       this.getStatus();
    },
    components: {},
    computed: {},
    methods: {
      goregistro(){
        this.$router.push({
          path: '/register'
        })
      },
      loginFacebook(){
        self =this
        FB.login(function(response) {
        if (response.authResponse) {
        console.log(response.authResponse.accessToken);
        FB.api('/me', function(response) {
          this.email = response.email;
          self.$store.state.user = response.name;
          console.log(self.$store.state.user)
          self.$router.push({
          path: '/home'
        })
        });
        } else {
        console.log('User cancelled login or did not fully authorize.');
        }
    },{scope: 'public_profile,email'});

      },
      getStatus(){
        return new Promise(resolve => {
               FB.getLoginStatus(responseStatus => {
                console.log(responseStatus);
                if (responseStatus.status === 'connected') {   // Logged into your webpage and Facebook.
                this.$router.push({
                path: '/home'
                })
              } else {                                 // Not logged into your webpage or we are unable to tell.

              }
              });
        });

      },
      login(){
        self = this 
        console.log(this)
        console.log(this.axios)
        this.$http.post('/logIn',{
          'email': this.email,
          'password': this.password
        })
        .then(function(r){
          self.$router.push({path: '/home'});
        })
        .catch(function(e){
          console.log(e)
          self.validForm = false
        })
      },
      getUserData() {
        
      FB.api('/me', 'GET', { fields: 'id,name,email' },
        userInformation => {
          console.warn("data api",userInformation)
          this.personalID = userInformation.id;
          this.email = userInformation.email;
          this.name = userInformation.name;
        }
      )
    },
    sdkLoaded(payload) {
      this.isConnected = payload.isConnected
      FB = payload.FB
      if (this.isConnected) this.getUserData()
    },
    onLogin() {
      this.isConnected = true
      this.getUserData()
    },
    onLogout() {
      this.isConnected = false;
    }
      
    }
  }
</script>